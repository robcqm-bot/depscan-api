# DepScan API — nginx reverse proxy with SSL
# Place at: /etc/nginx/sites-available/depscan.net
# Enable: ln -s /etc/nginx/sites-available/depscan.net /etc/nginx/sites-enabled/

server {
    listen 80;
    server_name depscan.net www.depscan.net;
    return 301 https://depscan.net;
}

server {
    listen 443 ssl http2;
    server_name depscan.net;

    ssl_certificate     /etc/letsencrypt/live/depscan.net/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/depscan.net/privkey.pem;
    ssl_protocols       TLSv1.2 TLSv1.3;
    ssl_ciphers         HIGH:!aNULL:!MD5;
    ssl_session_cache   shared:SSL:10m;
    ssl_session_timeout 10m;

    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains" always;
    add_header X-Frame-Options DENY always;
    add_header X-Content-Type-Options nosniff always;

    # API proxy
    location / {
        proxy_pass         http://127.0.0.1:8001;
        proxy_http_version 1.1;
        proxy_set_header   Host ;
        proxy_set_header   X-Real-IP ;
        proxy_set_header   X-Forwarded-For ;
        proxy_set_header   X-Forwarded-Proto ;

        # Timeouts — deep scans take longer
        proxy_connect_timeout  30s;
        proxy_send_timeout     120s;
        proxy_read_timeout     120s;

        # Rate limiting at nginx level (extra layer)
        limit_req zone=depscan_api burst=20 nodelay;
        limit_req_status 429;
    }
}
